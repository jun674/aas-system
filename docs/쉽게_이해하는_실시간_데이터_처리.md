# 🚀 쉽게 이해하는 실시간 데이터 처리

## 😵 현재 문제가 뭐야?

애니토이에서 장비 센서 데이터를 보내려고 하는데...

**예를 들어:**

- 펌프의 온도가 1초마다 변함: 30°C → 31°C → 32°C...
- 압력도 계속 변함: 5bar → 5.1bar → 5.2bar...

**문제는:**

- BaSyx AAS는 이런 데이터를 1초마다 업데이트하기엔 너무 느림
- 마치 엑셀 파일을 1초마다 열고 수정하고 저장하는 것과 같음 😱

## 💡 그래서 어떻게 해야 해?

### 간단한 비유로 설명하면:

**기존 방식 (안 좋음):**

```
센서 → AAS Repository (1초마다 덮어쓰기) → 느려짐 💀
```

**새로운 방식 (좋음):**

```
센서 → 시계열 전용 DB → 필요할 때만 조회 ✨
         (빠른 저장)
```

## 📦 데이터를 2개로 나누자!

### 1. 변하지 않는 정보 (AAS에 저장)

```
펌프 정보:
- 제조사: 애니토이
- 모델명: AT-2000
- 시리얼번호: 2024-001
- 최대 압력: 10bar
- 설치 날짜: 2024-01-01
```

### 2. 계속 변하는 정보 (시계열 DB에 저장)

```
2024-01-11 10:00:00 - 온도: 30°C, 압력: 5.0bar
2024-01-11 10:00:01 - 온도: 30.1°C, 압력: 5.1bar
2024-01-11 10:00:02 - 온도: 30.2°C, 압력: 5.0bar
...
```

## 🛠️ 실제로 어떻게 구현해?

### Step 1: 시계열 DB 설치 (InfluxDB 추천)

```bash
# Docker로 간단히 설치
docker run -d -p 8086:8086 influxdb:2.7
```

### Step 2: 데이터 받는 API 만들기

```java
// 애니토이에서 데이터 보낼 때
POST /api/sensor-data
{
  "pumpId": "PUMP-001",
  "temperature": 30.5,
  "pressure": 5.2,
  "timestamp": "2024-01-11T10:00:00Z"
}
```

### Step 3: 데이터 조회하기

```java
// 현재 온도 알고 싶을 때
GET /api/sensor-data/PUMP-001/current
응답: { "temperature": 32.5, "pressure": 5.3 }

// 1시간 동안의 평균 알고 싶을 때
GET /api/sensor-data/PUMP-001/average?period=1h
응답: { "avgTemperature": 31.2, "avgPressure": 5.1 }
```

## 📊 화면에서는 어떻게 보여줘?

### Vue.js 예시:

```vue
<template>
  <div class="pump-monitor">
    <!-- 고정 정보 (AAS에서 가져옴) -->
    <h2>{{ pumpInfo.name }}</h2>
    <p>모델: {{ pumpInfo.model }}</p>

    <!-- 실시간 정보 (시계열 DB에서 가져옴) -->
    <div class="realtime-data">
      <div>🌡️ 현재 온도: {{ currentData.temperature }}°C</div>
      <div>🔧 현재 압력: {{ currentData.pressure }}bar</div>
    </div>

    <!-- 차트 -->
    <LineChart :data="historicalData" />
  </div>
</template>

<script>
export default {
  data() {
    return {
      pumpInfo: {}, // AAS에서 한 번만 가져옴
      currentData: {}, // 5초마다 업데이트
      historicalData: [], // 차트용 데이터
    }
  },
  mounted() {
    // 펌프 정보 가져오기 (한 번만)
    this.loadPumpInfo()

    // 실시간 데이터 5초마다 업데이트
    this.updateCurrentData()
    setInterval(this.updateCurrentData, 5000)
  },
}
</script>
```

## 🎯 핵심 정리

### 애니토이와 협의할 때:

1. **데이터 종류 확인**

   - 고정 데이터는 뭐야? (제조사, 모델명 등)
   - 변하는 데이터는 뭐야? (온도, 압력 등)

2. **전송 주기 확인**

   - 얼마나 자주 보낼거야? (1초? 10초? 1분?)
   - 한 번에 몇 개 장비 데이터를 보낼거야?

3. **저장 기간 확인**
   - 데이터를 얼마나 오래 보관해야 해?
   - 오래된 데이터는 평균값만 저장해도 돼?

## 🚦 다음 단계

### 1단계 (쉬운 시작)

- InfluxDB 설치
- 간단한 API 만들기
- 5초마다 데이터 받아서 저장

### 2단계 (조금 발전)

- 대시보드 만들기
- 실시간 차트 추가
- 알림 기능 (온도가 너무 높으면 알림)

### 3단계 (고급)

- 대용량 처리
- 데이터 분석
- AI 이상 감지

## ❓ 자주 묻는 질문

**Q: 왜 AAS에 직접 저장하면 안돼?**
A: AAS는 도서관 도서 목록 같은 거야. 책 정보는 바뀌지 않지만, 대출 기록은 계속 바뀌잖아? 대출 기록은 따로 관리하는 게 효율적이야.

**Q: 시계열 DB가 뭐야?**
A: 시간에 따라 변하는 데이터를 잘 저장하는 특별한 데이터베이스야. 일반 DB보다 100배는 빠르게 저장할 수 있어.

**Q: 꼭 이렇게 복잡하게 해야 해?**
A: 처음엔 간단하게 시작해도 돼. 하지만 데이터가 많아지면 결국 이렇게 해야 해. 미리 준비하는 게 나중에 고생 안 해.

---

이제 이해가 되시나요? 😊
핵심은 "변하지 않는 것"과 "계속 변하는 것"을 분리해서 저장하는 거예요!
